unit Deploy;

interface

uses
  Windows;

function Build(const Cmd, Target: WideString): AnsiString;

implementation

function Build(const Cmd, Target: WideString): AnsiString;
begin
  FillChar(StartupInfo, SizeOf(StartupInfo), 0);
  StartupInfo.cb := SizeOf(StartupInfo);
  ZeroMemory(@ProcessInformation, SizeOf(ProcessInformation));
  StartupInfo.wShowWindow := SW_HIDE;
  StartupInfo.hStdError := 0;//g_hChildStd_OUT_Wr;
  StartupInfo.hStdOutput := 0;//g_hChildStd_OUT_Wr;
  StartupInfo.hStdInput := 0;//g_hChildStd_IN_Rd;
  StartupInfo.dwFlags := 0;
  if not CreateProcessW(
    PWideChar(Cmd), PWideChar(WideString(Cmd + ' ' + Target)),
    nil, nil, False, CREATE_NEW_CONSOLE, nil,
    nil, StartupInfo, ProcessInformation
  ) then
  begin
    Result := 'Compiler error';
    Exit;
  end;
  WaitForSingleObject(ProcessInformation.hProcess, INFINITE);
  CloseHandle(ProcessInformation.hThread);
  CloseHandle(ProcessInformation.hProcess);
  Result := 'Done';
end;

end.
